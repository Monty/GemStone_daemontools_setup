#!/bin/bash

if [ $UID -ne 0 ]; then
   echo "You must be root to run this"
   exit
fi 

echo "DANGER: This script *destroys* things, do NOT run it unless you know what you are doing."
echo "It's used to clean up unnecessary space in the GLASS Appliance before cloning it."
echo "It assumes GemStone is installed in /opt/gemstone/product. IT MAY BREAK YOUR SYSTEM!"
echo "Continue anyway? (Y/N)"

read cont
case "$cont" in
    y|Y|yes)
    ;;
    *)
    echo "Not continuing"
    exit
    ;;
esac

/etc/init.d/rsyslog stop

# Clear /etc/udev/rules.d/70-persistent-net.rules
cat > /etc/udev/rules.d/70-persistent-net.rules <<-EOF
    # This file was automatically generated by the /lib/udev/write_net_rules
    # program, run by the persistent-net-generator.rules rules file.
    #
    # You can modify it, as long as you keep each rule on a single
    # line, and change only the value of the NAME= key.
EOF

cd /

apt-get clean

rm /home/glass/.bash_history
rm -rf /home/glass/.cache/*
rm -f /home/glass/.lesshist
rm -f /home/glass/.viminfo
rm -f /home/glass/.vsd*
rm -f /home/glass/.Xauthority
rm -rf /home/glass/stats

rm /opt/gemstone/log/*
rm /opt/gemstone/locks/*
rm -f /opt/gemstone/product/seaside/data/tranlog*

rm -rf /root
mkdir /root

for i in `find /var/log -type f`; do
        echo >  $i
done

echo "You should shutdown -h now to clone or snapshot this Appliance"
